<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TennisFoundry — Daily Predictions</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    :root {
      --bg: #0b1220;
      --border: rgba(255, 255, 255, 0.08);
      --text: #e5e7eb;
      --muted: rgba(229, 231, 235, 0.68);
      --brand: #22c55e;
      --brand-2: #60a5fa;
      --shadow: 0 14px 40px rgba(0,0,0,0.45);
      --radius: 14px;
    }
    body {
      background: radial-gradient(1100px 700px at 20% -10%, rgba(34,197,94,0.18), transparent 55%),
                  radial-gradient(900px 650px at 90% 0%, rgba(96,165,250,0.18), transparent 50%),
                  var(--bg);
      color: var(--text);
    }
    .wrap { max-width: 1120px; margin: 0 auto; padding: 22px 18px 56px; }
    .topbar {
      display: flex; justify-content: space-between; align-items: center; gap: 16px;
      padding: 14px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      box-shadow: var(--shadow);
      position: sticky; top: 12px; z-index: 10;
      backdrop-filter: blur(10px);
    }
    .brand { display: flex; align-items: center; gap: 12px; min-width: 240px; }
    .logo {
      width: 38px; height: 38px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(34,197,94,0.95), rgba(96,165,250,0.95));
      box-shadow: 0 8px 22px rgba(34,197,94,0.15);
    }
    .brand h1 { font-size: 1.05rem; margin: 0; letter-spacing: 0.3px; line-height: 1.1; }
    .brand small { display: block; color: var(--muted); font-size: 0.78rem; margin-top: 2px; }
    .meta { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
    .chip {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; background: var(--brand);
      box-shadow: 0 0 0 3px rgba(34,197,94,0.15); }

    details {
      margin-top: 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(255,255,255,0.02);
      overflow: hidden;
    }
    details > summary {
      list-style: none; cursor: pointer;
      padding: 18px 16px;
      user-select: none;
      display: flex; justify-content: space-between; align-items: center; gap: 14px;
      background: rgba(255,255,255,0.03);
      border-bottom: 1px solid var(--border);
    }
    details > summary::-webkit-details-marker { display: none; }
    .tour-title { display: flex; align-items: baseline; gap: 12px; }
    .tour-title span { font-size: 1.15rem; font-weight: 850; letter-spacing: 0.3px; }
    .tour-title em { font-style: normal; color: var(--muted); font-size: 0.9rem; }

    .tourney-header {
      position: sticky; top: 82px; z-index: 6;
      background: rgba(11,18,32,0.88);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 12px 16px;
    }
    .tourney-row { display: flex; justify-content: space-between; align-items: baseline; gap: 10px; flex-wrap: wrap; }
    .tourney-name { margin: 0; font-size: 1.05rem; font-weight: 800; letter-spacing: 0.2px; }
    .surface-pill {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .match-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 16px;
      padding: 16px;
    }
    @media (max-width: 420px) { .match-grid { grid-template-columns: 1fr; } }

    .card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      overflow: hidden;
      position: relative;
    }
    .card::before { content: ""; position: absolute; inset: 0; border-left: 4px solid rgba(96,165,250,0.9); pointer-events: none; }

    .card-inner { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 16px 16px 14px; }
    @media (min-width: 1100px) { .card-inner { grid-template-columns: 1.25fr 0.75fr; gap: 16px; } }

    .players { display: grid; gap: 10px; }
    .player { display: flex; align-items: center; gap: 12px; }
    .avatar {
      width: 54px; height: 54px; border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      object-fit: cover; flex: 0 0 auto;
    }
    .pname { margin: 0; font-weight: 850; font-size: 1rem; line-height: 1.05; letter-spacing: 0.2px; }
    .prank { margin: 2px 0 0; color: var(--muted); font-size: 0.82rem; }
    .vs { color: rgba(229,231,235,0.35); font-weight: 900; letter-spacing: 2px; font-size: 0.8rem; margin-left: 66px; margin-top: -4px; }

    .pick { border-top: 1px solid var(--border); padding-top: 12px; }
    .label { color: var(--muted); font-size: 0.78rem; letter-spacing: 0.3px; text-transform: uppercase; margin-bottom: 6px; }
    .winner { font-size: 1.05rem; font-weight: 900; color: var(--brand-2); margin: 0; }
    .conf-row { display: flex; align-items: center; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
    .badge {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.82rem;
      font-weight: 850;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
    }
    .badge strong { color: var(--text); }
    .meter {
      height: 8px; border-radius: 999px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.08);
      flex: 1 1 160px; min-width: 160px;
    }
    .bar {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(34,197,94,0.9), rgba(96,165,250,0.9));
      width: 0%;
    }
    .reason { margin-top: 10px; color: rgba(229,231,235,0.78); line-height: 1.5; font-size: 0.92rem; }

    .empty {
      margin-top: 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(255,255,255,0.03);
      padding: 18px;
      text-align: center;
      color: var(--muted);
    }
    .empty strong { color: var(--text); }

    .footer-note { margin-top: 18px; color: rgba(229,231,235,0.55); font-size: 0.8rem; text-align: center; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>TennisFoundry</h1>
          <small>Daily AI match predictions</small>
        </div>
      </div>

      <div class="meta">
        <span class="chip"><span class="dot"></span> Live build</span>
        <span class="chip">Last updated: <strong style="color: var(--text); font-weight: 800;">{{ last_updated }} UTC</strong></span>
        <span class="chip">Design mode: <strong style="color: var(--text); font-weight: 800;">2 ATP + 2 WTA</strong></span>
      </div>
    </div>

    {% set any_matches = false %}
    {% for tour, tourneys in matches.items() %}
      {% if tourneys %}
        {% set any_matches = true %}
        <details open>
          <summary>
            <div class="tour-title">
              <span>{{ tour }} Predictions</span>
              <em>Today’s featured matches</em>
            </div>
            <div class="chip" style="padding:6px 10px;">AI confidence + one-line edge</div>
          </summary>

          <div>
            {% for tourney_name, tourney_data in tourneys.items() %}
              <div class="tourney-header">
                <div class="tourney-row">
                  <h3 class="tourney-name">{{ tourney_name }}</h3>
                  <span class="surface-pill">Surface: {{ tourney_data.surface }}</span>
                </div>
              </div>

              <div class="match-grid">
                {% for match in tourney_data.matches %}
                  <article class="card">
                    <div class="card-inner">
                      <div class="players">
                        <div class="player">
                          <img class="avatar"
                               src="{{ match.p1_image }}"
                               alt="{{ match.player1 }}"
                               loading="lazy"
                               referrerpolicy="no-referrer"
                               onerror="this.onerror=null;this.src='{{ match.p1_avatar }}';" />
                          <div>
                            <p class="pname">{{ match.player1 }}</p>
                            <p class="prank">Rank: {{ match.p1_rank }}</p>
                          </div>
                        </div>

                        <div class="vs">VS</div>

                        <div class="player">
                          <img class="avatar"
                               src="{{ match.p2_image }}"
                               alt="{{ match.player2 }}"
                               loading="lazy"
                               referrerpolicy="no-referrer"
                               onerror="this.onerror=null;this.src='{{ match.p2_avatar }}';" />
                          <div>
                            <p class="pname">{{ match.player2 }}</p>
                            <p class="prank">Rank: {{ match.p2_rank }}</p>
                          </div>
                        </div>
                      </div>

                      <div class="pick">
                        <div class="label">Model Pick</div>
                        <p class="winner">{{ match.prediction.winner }}</p>

                        {% set c = match.prediction.confidence %}
                        <div class="conf-row">
                          <span class="badge">Confidence <strong>{{ c }}%</strong></span>
                          <div class="meter" aria-label="Confidence meter">
                            <div class="bar" style="width: {{ c }}%;"></div>
                          </div>
                        </div>

                        <div class="reason">“{{ match.prediction.reasoning }}”</div>
                      </div>

                    </div>
                  </article>
                {% endfor %}
              </div>
            {% endfor %}
          </div>
        </details>
      {% endif %}
    {% endfor %}

    {% if not any_matches %}
      <div class="empty">
        <p style="margin:0 0 8px;"><strong>No matches found for the current build window.</strong></p>
        <p style="margin:0;">
          This build was likely rate-limited (HTTP 429). We’ll automatically reuse the last successful cached match list when available.
        </p>
      </div>
    {% endif %}

    <div class="footer-note">
      Predictions are informational and may be wrong. Always verify lineups/injuries before betting.
    </div>
  </div>
</body>
</html>
